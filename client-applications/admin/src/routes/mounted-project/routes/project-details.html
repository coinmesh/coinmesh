<template>
  <require from="components/terminal-output"></require>
  <require from="../components/project-info"></require>
  <require from="components/card-item"></require>
  <require from="components/display-item"></require>

  <card-item is-open.bind="true">
    <span slot="header">Containers</span>
    <div class="row">
      <div class="col">
        <p>Containers may need to be started in order.</p>
      </div>
    </div>
    <div class="row">
      <div class="col" repeat.for="container of projectStore.currentProject.dockerContainers">
        <section class="card">
          <div class="card-header user-header alt bg-dark">
            <div class="media">
              <a>
                <img
                  class="align-self-center rounded-circle mr-3"
                  style="width:85px; height:85px; background-color: black;"
                  alt=""
                  src="assets/images/${container.name}-logo.png">
              </a>
              <div class="media-body">
                <h2 class="text-light display-6">
                  ${container.name}
                  <i css="color: ${container.status === 'up' ? 'green' : container.status === 'exit' ? 'red' : 'gray'}"
                    class="fa
                      fa-${
                        container.locked === true ? 'lock' :
                          container.status === 'up' ? 'check-circle' :
                            container.status === 'exit' ? 'times-circle' :
                              container.status === 'pending' ? 'circle-o-notch fa-spin' : 'question-circle'
                      }
                      pull-right">
                  </i>
                </h2>
                <p>${container.status}</p>
              </div>
            </div>
          </div>

          <ul class="list-group list-group-flush">
            <template if.bind="container.canGenerate">
              <li class="list-group-item">
                <template if.bind="container.generateBlocksOpen">
                  <input value.bind="numberOfBlocks"
                    class="form-control"
                    placeholder="Number of blocks"
                    if.bind="container.generateBlocksOpen"/>
                  <a href="#" click.delegate="generateBlocks()">
                    <i class="fa fa-arrow-circle-right"></i> Generate Blocks
                  </a>
                </template>
                <a href="#"
                    click.delegate="container.toggleOpen('generateBlocksOpen')"
                    if.bind="!container.generateBlocksOpen">
                  <i class="fa fa-arrow-circle-right"></i> Generate Blocks
                </a>
              </li>
              <li class="list-group-item">
                <a href="#" click.delegate="toggleContinuouslyGenerateBlocks()">
                  <i class="fa fa-${!isGeneratingBlocks ? 'play-circle-o' : 'pause-circle-o'}"></i>
                  ${!isGeneratingBlocks ? 'Start' : 'Stop'} Generating Blocks
                </a>
              </li>
            </template>

            <template if.bind="container.canSend">
              <li class="list-group-item">
                <template if.bind="container.sendCoinsOpen">
                  <input value.bind="sendToAddress"
                    class="form-control"
                    placeholder="Address to send to"/>
                  <input value.bind="numberOfCoins"
                    class="form-control"
                    placeholder="Number of coins"/>
                  <a href="#" click.delegate="sendCoins()">
                    <i class="fa fa-send"></i> Send Coins to Address
                  </a>
                </template>
                <a href="#"
                    click.delegate="container.toggleOpen('sendCoinsOpen')"
                    if.bind="!container.sendCoinsOpen">
                  <i class="fa fa-send"></i> Send Coins to Address
                </a>
              </li>
            </template>

            <li class="list-group-item">
              <template if.bind="container.status !== 'up'">
                <i class="fa fa-play-circle"></i>
                <a href="#" click.delegate="start(container)">Start</a>
              </template>
              <template if.bind="container.status === 'up'">
                <i class="fa fa-stop-circle"></i>
                <a href="#" click.delegate="stop(container)">Stop</a>
              </template>
            </li>
          </ul>
        </section>
      </div>
    </div>

    <div class="row">
      <div class="col">
      <div class="col">
        <a class="btn btn-center btn-outline-success" href="#" click.delegate="up()">Start all Containers</a>
        <a class="btn btn-center btn-outline-danger" href="#" click.delegate="down()">Stop all Containers</a>
      </div>
    </div>
  </card-item>

  <project-info project.bind="projectStore.currentProject"></project-info>

  <terminal-output
    project-root.bind="projectStore.currentProject.path">
  </terminal-output>
</template>
